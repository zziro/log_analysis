
Task 1: most_popular_articles

CREATE OR REPLACE VIEW most_popular_articles AS
SELECT art.title, COUNT(lg.id) as views 
FROM articles as art 
JOIN log as lg ON art.slug = substring(lg.path,10) AND lg.status = '200 OK' 
GROUP BY art.title 
ORDER BY views desc;


Task 2: most_popular_authors

CREATE OR REPLACE VIEW most_popular_authors AS
SELECT aut.name, COUNT(lg.id) as views 
FROM articles as art JOIN log as lg ON art.slug = substring(lg.path,10) AND lg.status = '200 OK' JOIN authors AS aut ON aut.id = art.author  
GROUP BY aut.name 
ORDER BY views desc;


Task 3: days_with_more_errors

CREATE OR REPLACE VIEW days_with_more_errors AS
SELECT TO_CHAR(time::date, 'Mon DD, YYYY') as date, CONCAT((COUNT(status)*100/(SELECT COUNT(status)
FROM log WHERE status = '404 NOT FOUND')))||'% errors' as errors_per_day 
FROM log where status = '404 NOT FOUND' 
GROUP BY time::date
ORDER BY time::date;